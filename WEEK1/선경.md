-----

Chapter02. 애플리케이션 계층

-----

### 네트워크 애플리케이션 구조
#### 클라이언트-서버 구조  
웹 서버가 클라이언트로부터 요청을 받으면 웹 서버는 요청 데이터를 클라이언트로 보내 응답  

* 서로 직접적으로 통신하지 않음  
* 서버가 고정 IP 주소라는 잘 알려진 주소를 가짐  

ex) 웹, 파일 전송, 원격 로그인, 전자메일 등

많은 요청이 들어오게 되면 클라이언트에 응답이 지연되는 등의 문제가 발생하기 때문에  
**데이터 센터** 라는 것이 존재함  

데이터센터 :  
데이터 저장 및 처리 공유를 위한 통합관리 시설  
서버 컴퓨터들을 한 장소에 모아 안정적으로 관리할 수 있음
<br>

#### P2P 구조  
항상 켜져 있는 인프라스트럭처 서버에 최소로 의존함  
대신 애플리케이션은 피어 라는 간헐적으로 연결된 호스트 쌍이 서로 직접 통신하게 함  

* 자가 확장성이라는 특징이 있음  
* 상당한 서버 인프라스트럭처와 서버 대역폭을 요구하지 않음

ex) 비트토렌트  

### 프로세스 간 통신  
#### 클라이언트와 서버 프로세스  
서로 메시지를 보내는 두 프로세스로 구성됨  
클라이언트 프로세스와 서버 프로세스는 메시지를 교환함  

#### 프로세스와 컴퓨터 네트워크 사이의 인터페이스  
프로세스가 소켓을 통해 네트워크로 메시지를 보내고 받음  

소켓 :  
네트워크 애플리케이션이 인터넷에 만든 프로그래밍 인터페이스  
애플리케이션과 네트워크 사이의 API  

#### 프로세스 주소 배정  
하나의 프로세스에서 다른 프로세스로 패킷을 보내기 위해서는 수신 프로세스를 식별하기 위해  
호스트의 주소, 그 목적지 호스트 내의 수신 프로세스를 명시하는 식별자 두 가지 정보가 명시되어야 함  
이를 위해 **포트 번호** 사용  

### 인터넷 전송 프로토콜이 제공하는 서비스
#### TCP/IP  
인터넷 표준 프로토콜로서 컴퓨터 간의 주고받는 데이터를 전송할 때  
에러가 발생하지 않도록 알맞게 나누어 전송하고  
이를 수신하여 다시 기존의 정보로 변환하는 것을 약속해 놓은 것  

데이터의 흐름 관리, 정확성 확인, 패킷의 목적지 보장을 담당  
TCP/IP의 전송 계층에서 TCP와 UDP라는 두 종류의 프로토콜이 사용됨  

#### UDP  
* 최초의 서비스 모델을 가진 간단한 전송 프로토콜  
* 비연결형  
* 비신뢰적인 데이터 전송 서비스 제공
* 혼합 제어 방식 미포함
#### TCP
* 연결지향형 서비스 제공
* 신뢰적인 데이터 전송 서비스 제공
* 혼합 제어 방식 포함  

### 애플리케이션 계층 프로토콜  
다른 종단 시스템에서 실행되는 애플리케이션의 프로세스가  
서로 메시지를 보내는 방법을 정의  
* 교환 메시지 타입  
  ex) 요청 메시지와 응답 메시지
* 여러 메시지 타입의 문법  
  ex) 메시지 내부의 필드와 필드 간의 구별 방법  
* 필드에 있는 정보의 의미  
* 언제 어떻게 프로세스가 메시지를 전송하고 메시지에 응답하는지 결정하는 규칙

### HTTP  
HTML 문서와 같은 리소스들을 가져올 수 있도록 해주는 프로토콜  
웹에서 이루어지는 모든데이터 교환의 기초이며, 클라이언트-서버 프로토콜이기도 함  
웹의 애플리케이션 계층 프로토콜  
TCP 혹은 암호화된 TCP 연결인 TLS를 통해 전송됨  

### HTTP 메시지 포멧  
#### HTTP 요청 메시지
```nasm
GET / somedir/page.html HTTP/1.1
Host: www.someschool.edu
Connection: close
User-agent: Mozilla/5.0
Accept-language: fr
```
* 첫줄 (요청라인) :  
  방식필드, URL필드, HTTP 버전 필드를 가짐
* 첫줄 이외의 줄 (헤더라인) :  
  * Host : 객체가 존재하는 호스트 명시
  * Connection : 지속 연결 사용 여부  
  * User-agent : 서버에게 요청하는 브라우저 타입  
  * Accept-language : 객체의 언어 버전  

#### HTTP 응답 메시지  
```nasm
HTTP/1.1 200 OK
Connection: close
Date: True, 18 Aug 2015 15:44:04 GMT
Server: Apache/2.2.3
Last-Modified: True, 18 Aug 2015 15:11:03 GMT
Content-Length: 6821
Content-Type: text/html
```
* 상태 라인 :  
  프로토콜 버전 필드, 상태 코드, 해당 상태 메시지를 가짐  
* Connection : close :  
  클라이언트에게  메시지를 보낸 후 TCP연결을 닫는 데 사용  
* Date :  
  HTTP 응답이 서버에 의해 생성되고 보낸 날짜와 시간을 나타냄  
* Server :  
  메시지가 아파치 웹 서버에 의해 만들어졌음을 의미  
* Last-Modified :  
  객체가 생성되거나 마지막으로 수정된 시간과 날짜를 나타냄  
* Content-Length :  
  송신되는 객체의 바이트 수  
* Content-Type :  
  개체 몸체 내부의 객체가 HTML 텍스트인 것을 나타냄  

#### 상태 코드  
* 200 OK :  
  요청이 성공했고, 정보가 응답으로 보내짐  
* 301 Moved Permanently :  
  요청된 리소스가 영구적으로 이동 페이지로 이동  
* 400 Bad Request :  
  서버가 요청을 이해할 수 없다는 일반 오류 코드  
* 404 Not Found :  
  요청 문서가 서버에 존재하지 않음  
* 505 HTTP Version Not Supported :  
  요청 HTTP 프로토콜 버전을 서버가 지원하지 않음  

### 쿠키  
서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각  
주로 세션 관리, 개인 설정유지, 사용자 트래킹 등의 용도로 사용됨  

* 한개에 4KB까지 저장 가능, 최대 300개까지 저장할 수 있는 텍스트 파일
* 클라이언트에 저장됨  
* 이름, 값, 만료날짜, 경로 정보가 들어있음  
* 기본적으로 웹 브라우저가 종료되면 삭제됨 (만료날짜를 지정하는 경우 만료일이 되어야 삭제됨)  
* 웹 브라우저에 해당 서버의 쿠키 정보가 있으면 HTTP 요청에 무조건 담아 보냄  

#### 동작방식  
1. HTTP요청  
2. 쿠키를 HTTP 헤더(Set-Cookie)에 담아서 응답  
3. 쿠키 저장 / HTTP 재요청 (쿠키포함)
4. 응답 (쿠키 업데이트 시 전달)  

### 웹 캐싱  
#### 캐싱  
애플리케이션의 처리 속도를 높어줌  
이미 가져온 데이터나 계산된 결과값의 복사본을 저장하여 처리 속도를 향상시킴  
대부분의 프로그램이 동일한 데이터나 명령어에 반복해서 엑세스 하기 때문에  
효율적인 아키텍처 패턴  
#### 웹 캐시  
사용자가 웹 사이트에 접속할 때 정적 컨텐츠를 특정 위치에 저장하여  
웹 사이트 서버에 해당 컨텐츠를 매번 요청하여 받는것이 아니라,  
특정 위치에서 불러옴으로써 사이트 응답시간을 줄이고 서버 트래픽 감소 효과를 볼 수 있음  

### SMTP  
인터넷 전자메일을 위한 주요 애플리케이션 계층 프로토콜  
메일을 송신자의 메일 서버로부터 수신자의 메일 서버로 전송하는 데  
TCP의 신뢰적인 데이터 전송 서비스를 이용

#### SMTP 사용 포트
* 기본 TCP 포트 : 25  
* TLS 포트 : 587  
* SSL 포트 : 465

#### SMTP 작동 방식
1. SMTP 연결 열림
2. 이메일 데이터 전송
3. 메일 전송 에이전트(MTA)
4. 연결 닫힘  

### DNS
네트워크의 도메인이나 호스트 이름을 숫자로 된 IP 주소로 해석해주는 네트워크 서비스  

#### URL 입력 시 발생하는 일  
URL을 웹 브라우저의 주소창에 입력하면 DNS 서버를 조회해서 도메인에 해당하는 IP를 받아옴  
해당 IP를 가지고 있는 서버와 TCP 프로토콜 기반으로 세션을 수립  
클라이언트는 서버로부터 자원을 받은 뒤 세션 종료  

### CDN  
컨텐츠를 전달하는 네트워크를 구성하는 것  
웹 서버가 아니라 현재 사용자가 접속한 위치에서 가장 가까운 서버에 리소스를 캐싱 해놓고  
보다 빠르게 가져오는 기법  
정적 리소스를 보다 빠른 속도로 서비스 할 수 있음  

#### CDN 장점  
* 리소스를 캐싱해놓기 때문에 응답속도(로딩속도)가 빠름  
* Origin 서버의 부하가 줄어듬  

#### CDN 단점  
* 캐시서버 네트워크를 구축하는 데 비용이 많이 듬  
* 사용자가 CDN을 막아놓으면 리소스 로딩이 막힘  

### 소켓 프로그래밍: 네트워크 애플리케이션 생성  
#### 소켓 프로그래밍  
프로그램이 네트워크에서 데이터를 송수신 할 수 있도록  
네트워크 환경에 연결할 수 있게 만들어진 연결부

#### UDP 소켓 프로그래밍
* 비연결 기반 (1:1, 1:N, N:N 통신 방식)
* 데이터 경계를 구분
* 신뢰성 없는 데이터 전송
* 필수 서비스만 제공
* 카운터 파트들 사이에 정보를 공유할 필요가 없어 가벼움
* tcp보다 전송속도 빠름

#### TCP 소켓 프로그래밍  
* 연결 지향 프로토콜 (1:1 통신 방식)  
* 데이터 경계 구분이 없음  
* 신뢰성 있는 데이터 전송  
* 순차적인 정보 전달
* 흐름 제어
* 혼잡 제어
* 연결과정에서 handshake과정이 있기 때문에 udp보다 느림


TCP와 UDP 모두 TCP/IP 프로토콜에 포함되어 있으며  
OSI 7계층의 전송 계층에 해당하는 프로토콜

<br>

#### 참고  
[데이터 센터가 뭘까?](https://contents.premium.naver.com/3mit/wony/contents/220629180331264fm)  
[TCP와 UDP 차이 그리고 TCP/IP](https://madplay.github.io/post/network-tcp-udp-tcpip)  
[르윈의 TCP UDP](https://www.youtube.com/watch?v=ikDVGYp5dhg)  
[HTTP 쿠키와 세션이란?](https://noahlogs.tistory.com/38)  
[웹 캐시(WEB Cache)란 무엇인가?(특징)](https://hahahoho5915.tistory.com/33)  
[단순 전자우편 전송 프로토콜(SMTP)이란?](https://www.cloudflare.com/ko-kr/learning/email-security/what-is-smtp/)  
[SMTP를 알아보자](https://mutpp.tistory.com/4)  
[DNS & CDN](https://donguk.netlify.app/cs/dns-&-cdn/)  
[소켓 프로그래밍](https://recipes4dev.tistory.com/153)  
[UDP 소켓 프로그래밍](https://dongwooklee96.github.io/post/2021/08/09/udp-%EC%86%8C%EC%BC%93-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D.html)  
[소켓 프로그래밍(TCP, UDP)](https://m.blog.naver.com/xowns4817/221914758942)
